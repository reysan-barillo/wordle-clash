<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Wordle Clash</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0;}
:root{
  --bg:#1a2535;
  --tile-empty:#2a3a50;
  --tile-border:#3d5068;
  --tile-absent:#3a4a5c;
  --tile-present:#c9a12a;
  --tile-correct:#2e8b57;
  --tile-orange:#c84e1a;
  --key-bg:#2a3a50;
  --key-absent:#1e2a38;
  --txt:#f0ede8;
  --txt-dim:rgba(240,237,232,0.55);
  --val-grd:radial-gradient(ellipse at 50% 25%, #8b2035 0%, #5a1525 45%, #3a0d18 100%);
}
body{background:var(--bg);color:var(--txt);font-family:'Nunito',sans-serif;min-height:100vh;display:flex;flex-direction:column;align-items:center;overflow-x:hidden;}
.screen{display:none;width:100%;min-height:100vh;flex-direction:column;align-items:center;}
.screen.active{display:flex;}

/* TOAST */
#toast{position:fixed;top:16px;left:50%;transform:translateX(-50%) translateY(-80px);background:var(--txt);color:#1a2535;font-size:.85rem;font-weight:800;padding:9px 22px;border-radius:5px;z-index:999;transition:transform .3s cubic-bezier(.34,1.56,.64,1);white-space:nowrap;pointer-events:none;}
#toast.show{transform:translateX(-50%) translateY(0);}

/* HEADER */
.g-header{width:100%;max-width:500px;display:flex;align-items:center;justify-content:space-between;padding:14px 16px 12px;border-bottom:1px solid rgba(255,255,255,.1);}
.g-title{font-size:1.4rem;font-weight:900;letter-spacing:.1em;text-transform:uppercase;}
.g-sub{font-size:.67rem;color:var(--txt-dim);letter-spacing:.07em;margin-top:2px;}

/* BOARD */
#board-wrap{flex:1;display:flex;align-items:center;justify-content:center;padding:10px 0;}
#board{display:grid;grid-template-rows:repeat(6,1fr);gap:5px;}
.b-row{display:grid;grid-template-columns:repeat(5,1fr);gap:5px;}
.tile{width:60px;height:60px;border:2px solid var(--tile-border);background:var(--tile-empty);display:flex;align-items:center;justify-content:center;font-size:1.85rem;font-weight:800;color:var(--txt);text-transform:uppercase;user-select:none;}
.tile.filled{border-color:rgba(255,255,255,.3);}
.tile.absent{background:var(--tile-absent);border-color:var(--tile-absent);animation:flip .5s ease forwards;}
.tile.present{background:var(--tile-present);border-color:var(--tile-present);animation:flip .5s ease forwards;}
.tile.correct{background:var(--tile-correct);border-color:var(--tile-correct);animation:flip .5s ease forwards;}
@keyframes flip{0%{transform:rotateX(0);}45%,55%{transform:rotateX(-90deg);}100%{transform:rotateX(0);}}
@keyframes popTile{0%,100%{transform:scale(1);}50%{transform:scale(1.12);}}
.tile.pop{animation:popTile .09s ease;}
@keyframes rowShake{0%,100%{transform:translateX(0);}20%,60%{transform:translateX(-6px);}40%,80%{transform:translateX(6px);}}
.row-shake{animation:rowShake .4s ease;}
@keyframes rowBounce{0%,100%{transform:translateY(0);}25%{transform:translateY(-10px);}75%{transform:translateY(-4px);}}
.row-bounce{animation:rowBounce .5s ease;}

/* BOTTOM */
#bottom-area{width:100%;max-width:500px;padding-bottom:16px;display:flex;flex-direction:column;align-items:center;}
#hint-line{font-size:.72rem;color:var(--txt-dim);letter-spacing:.05em;min-height:18px;margin-bottom:8px;text-align:center;}
#action-btns{display:none;gap:10px;margin-bottom:10px;}
.btn-play{background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);color:var(--txt);font-family:'Nunito',sans-serif;font-size:.85rem;font-weight:700;padding:10px 24px;border-radius:6px;cursor:pointer;transition:background .2s;letter-spacing:.05em;}
.btn-play:hover{background:rgba(255,255,255,.2);}
.btn-giveup{background:transparent;border:1px solid rgba(255,255,255,.12);color:var(--txt-dim);font-family:'Nunito',sans-serif;font-size:.85rem;font-weight:600;padding:10px 24px;border-radius:6px;cursor:pointer;transition:all .2s;letter-spacing:.05em;}
.btn-giveup:hover{color:var(--txt);border-color:rgba(255,255,255,.3);}

/* KEYBOARD */
.kbd{width:100%;max-width:500px;display:flex;flex-direction:column;gap:6px;padding:0 6px;}
.k-row{display:flex;justify-content:center;gap:5px;}
.key{height:52px;flex:1;min-width:30px;max-width:44px;background:var(--key-bg);border:none;border-radius:5px;color:var(--txt);font-family:'Nunito',sans-serif;font-size:.84rem;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;text-transform:uppercase;transition:background .12s,transform .08s;user-select:none;-webkit-tap-highlight-color:transparent;}
.key.wide{flex:1.55;font-size:.7rem;max-width:none;}
.key:active{transform:scale(.91);}
.key.absent{background:var(--key-absent);opacity:.55;}
.key.present{background:var(--tile-present);}
.key.correct{background:var(--tile-correct);}
.key.hint-glow{background:var(--tile-correct);box-shadow:0 0 20px rgba(46,139,87,.7);animation:pulse-hint 1.5s ease infinite;}
@keyframes pulse-hint{0%,100%{box-shadow:0 0 20px rgba(46,139,87,.7);}50%{box-shadow:0 0 30px rgba(46,139,87,1);}}

/* VAL BG */
.val-bg{background:var(--val-grd);position:relative;overflow:hidden;}
.stars-cv{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0;}

/* VAL KEYBOARD */
.val-kbd .key{background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.1);}
.val-kbd .key.absent{background:rgba(0,0,0,.2);border-color:rgba(255,255,255,.05);opacity:.5;}
.val-kbd .key.present{background:var(--tile-present);}
.val-kbd .key.correct{background:var(--tile-correct);}
.val-kbd .key.hint-glow{background:var(--tile-correct);border-color:var(--tile-correct);box-shadow:0 0 20px rgba(46,139,87,.7);animation:pulse-hint 1.5s ease infinite;}

/* VALENTINE SCREEN */
.val-inner{position:relative;z-index:1;display:flex;flex-direction:column;align-items:center;padding:50px 20px 20px;width:100%;max-width:500px;flex:1;}
.val-title{font-size:clamp(1.8rem,7vw,2.7rem);font-weight:900;text-align:center;margin-bottom:10px;line-height:1.2;}
.val-sub{font-size:.78rem;color:var(--txt-dim);letter-spacing:.07em;margin-bottom:24px;text-align:center;}

/* 3-tile answer row */
#ans-board{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin-bottom:22px;}
#ans-board.row-shake{animation:rowShake .4s ease;}
.a-tile{width:64px;height:64px;border:2px solid rgba(255,255,255,.14);background:rgba(255,255,255,.05);display:flex;align-items:center;justify-content:center;font-size:2.1rem;font-weight:800;color:var(--txt);text-transform:uppercase;}
.a-tile.filled{border-color:rgba(255,255,255,.32);}
@keyframes tileOrange{0%{transform:rotateX(-90deg);opacity:0;}100%{transform:rotateX(0);opacity:1;}}
.a-tile.orange{background:var(--tile-orange);border-color:var(--tile-orange);animation:tileOrange .35s ease forwards;}
@keyframes apop{0%,100%{transform:scale(1);}50%{transform:scale(1.12);}}
.a-tile.pop{animation:apop .09s ease;}

/* hint below keyboard */
#val-hint{
  font-size:.78rem;
  color:rgba(232,160,160,0.85);
  text-align:center;
  margin-top:14px;
  min-height:22px;
  letter-spacing:.04em;
  position:relative;z-index:1;
  transition:opacity .3s;
}

/* PREPARING */
.prep-inner{position:relative;z-index:1;display:flex;flex-direction:column;align-items:center;justify-content:center;flex:1;padding:40px 20px;text-align:center;}
.prep-tiles{display:flex;gap:8px;margin:24px 0 22px;}
.p-tile{width:66px;height:66px;background:var(--tile-orange);border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:2.2rem;font-weight:800;color:#fff;opacity:0;transform:scale(.4) rotate(-12deg);transition:opacity .35s,transform .45s cubic-bezier(.34,1.56,.64,1);}
.p-tile.show{opacity:1;transform:scale(1) rotate(0deg);}
.prep-label{font-size:1.1rem;font-weight:700;margin-bottom:8px;}
.prep-dots span{display:inline-block;animation:dp 1.2s infinite;}
.prep-dots span:nth-child(2){animation-delay:.2s;}
.prep-dots span:nth-child(3){animation-delay:.4s;}
@keyframes dp{0%,80%,100%{transform:scale(1);opacity:.35;}40%{transform:scale(1.5);opacity:1;}}

/* CELEBRATION */
.celeb-inner{position:relative;z-index:1;display:flex;flex-direction:column;align-items:center;justify-content:center;flex:1;padding:40px 20px;text-align:center;gap:10px;}
.celeb-tiles{display:flex;gap:8px;margin:6px 0 14px;}
.c-tile{width:66px;height:66px;background:var(--tile-orange);border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:2.2rem;font-weight:800;color:#fff;}
.celeb-h{font-size:clamp(1.8rem,7vw,2.7rem);font-weight:900;line-height:1.2;}
.celeb-msg{font-size:1rem;font-weight:700;}
.celeb-sub{font-size:.82rem;color:var(--txt-dim);max-width:320px;line-height:1.65;}
.email-box{display:flex;flex-direction:column;gap:8px;width:100%;max-width:320px;margin-top:10px;}
.btn-email{background:var(--tile-orange);color:#fff;font-family:'Nunito',sans-serif;font-size:.87rem;font-weight:700;padding:13px 20px;border-radius:6px;border:none;cursor:pointer;letter-spacing:.05em;transition:background .2s,transform .1s;box-shadow:0 4px 20px rgba(200,78,26,.35);}
.btn-email:hover{background:#a83e14;transform:translateY(-2px);}
.btn-email:disabled{background:#555;cursor:default;transform:none;}
.e-status{font-size:.72rem;color:rgba(255,255,255,.45);min-height:18px;text-align:center;}

/* VIDEO MODAL (after email sent) */
#screen-video{position:fixed;inset:0;z-index:10000;background:#000;display:none;align-items:center;justify-content:center;overflow:hidden;}
#screen-video.active{display:flex;}
#screen-video .video-wrap{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;}
#screen-video video{max-width:100%;max-height:100%;width:auto;height:auto;object-fit:contain;}
#screen-video .btn-close-video{position:absolute;top:16px;right:16px;width:44px;height:44px;border-radius:50%;background:rgba(255,255,255,.15);border:1px solid rgba(255,255,255,.25);color:#fff;font-size:1.2rem;cursor:pointer;z-index:10001;display:flex;align-items:center;justify-content:center;transition:background .2s;}
#screen-video .btn-close-video:hover{background:rgba(255,255,255,.3);}

/* ANIMATIONS */
@keyframes fiu{from{opacity:0;transform:translateY(16px);}to{opacity:1;transform:translateY(0);}}
.fiu{opacity:0;animation:fiu .6s ease forwards;}
.d1{animation-delay:.05s;}.d2{animation-delay:.2s;}.d3{animation-delay:.38s;}.d4{animation-delay:.55s;}.d5{animation-delay:.72s;}

/* SHUFFLE ANIMATION */
@keyframes shuffleLetter{
  0%{transform:translateY(0) rotate(0deg);opacity:1;}
  25%{transform:translateY(-20px) rotate(180deg);opacity:.5;}
  50%{transform:translateY(0) rotate(360deg);opacity:1;}
  75%{transform:translateY(-15px) rotate(540deg);opacity:.7;}
  100%{transform:translateY(0) rotate(720deg);opacity:1;}
}
.tile.shuffle{animation:shuffleLetter 1.2s ease-in-out forwards;}

@media(max-width:380px){
  .tile{width:52px;height:52px;font-size:1.6rem;}
  .key{height:46px;}
  .a-tile,.p-tile,.c-tile{width:56px;height:56px;font-size:1.85rem;}
}
</style>
</head>
<body>

<!-- GAME -->
<div id="screen-game" class="screen active">
  <div class="g-header">
    <div>
      <div class="g-title">Wordle Clash</div>
      <div class="g-sub">Might be a little confusing...</div>
    </div>
    <div style="font-size:.68rem;color:var(--txt-dim);letter-spacing:.06em;" id="counter">0 / 6</div>
  </div>
  <div id="board-wrap"><div id="board"></div></div>
  <div id="bottom-area">
    <div id="hint-line"></div>
    <div id="action-btns">
      <button class="btn-play" onclick="playAgain()">Play Again</button>
      <button class="btn-giveup" onclick="giveUp()">Give Up</button>
    </div>
    <div class="kbd" id="keyboard"></div>
  </div>
</div>

<!-- VALENTINE QUESTION -->
<div id="screen-val" class="screen val-bg">
  <canvas class="stars-cv" id="sc1"></canvas>
  <div class="val-inner">
    <div class="val-title fiu d1">Will You Be<br>My Valentine?</div>
    <div class="val-sub fiu d2">Type your answer below üíï</div>
    <div id="ans-board" class="fiu d3">
      <div id="at0" class="a-tile"></div>
      <div id="at1" class="a-tile"></div>
      <div id="at2" class="a-tile"></div>
    </div>
    <div class="kbd val-kbd fiu d4" id="val-keyboard"></div>
    <div id="val-hint" class="fiu d5"></div>
  </div>
</div>

<!-- PREPARING -->
<div id="screen-prep" class="screen val-bg">
  <canvas class="stars-cv" id="sc2"></canvas>
  <div class="prep-inner">
    <div class="prep-tiles">
      <div id="pt0" class="p-tile">Y</div>
      <div id="pt1" class="p-tile">E</div>
      <div id="pt2" class="p-tile">S</div>
    </div>
    <div class="prep-label">Preparing something special</div>
    <div class="prep-dots"><span>.</span><span>.</span><span>.</span></div>
  </div>
</div>

<!-- CELEBRATION -->
<div id="screen-celeb" class="screen val-bg">
  <canvas class="stars-cv" id="sc3"></canvas>
  <div class="celeb-inner">
    <div class="celeb-tiles fiu d1">
      <div class="c-tile">Y</div>
      <div class="c-tile">E</div>
      <div class="c-tile">S</div>
    </div>
    <div class="celeb-h fiu d2">YES!</div>
    <div class="celeb-msg fiu d3">You made my day! ‚ù§Ô∏è</div>
    <div class="celeb-sub fiu d4">I've prepared something special just for you. Click below to send your surprise!</div>
    <div class="email-box fiu d5">
      <button id="sendBtn" class="btn-email" onclick="sendEmail()">Send Me the Surprise</button>
      <div id="eStatus" class="e-status"></div>
    </div>
  </div>
</div>

<!-- VIDEO MODAL (after email sent) -->
<div id="screen-video" class="screen">
  <button type="button" class="btn-close-video" onclick="closeVideoScreen()" aria-label="Close">‚úï</button>
  <div class="video-wrap">
    <video id="surpriseVideo" playsinline muted loop></video>
  </div>
</div>

<div id="toast"></div>

<script>
// ‚ïê‚ïê GLOBAL ‚ïê‚ïê
const TARGET='SMILE';
const HINTS=['','','','','',''];
let cRow=0, cCol=0, guess=[], locked=false, kbdMap={}, vKbdMap={};
let aCol=0, aGuess=[], aLocked=false, noCount=0;
let gaveUp=false;

// ‚ïê‚ïê TOAST ‚ïê‚ïê
function showToast(msg){ 
  const t=document.getElementById('toast'); 
  t.textContent=msg; 
  t.classList.add('show'); 
  setTimeout(()=>t.classList.remove('show'), 1600); 
}

// ‚ïê‚ïê INIT BOARD ‚ïê‚ïê
function initBoard(){
  const bd=document.getElementById('board');
  bd.innerHTML='';
  for(let r=0;r<6;r++){
    const row=document.createElement('div'); row.className='b-row'; row.id='row'+r;
    for(let c=0;c<5;c++){
      const tile=document.createElement('div'); tile.className='tile'; tile.id='t'+r+'-'+c;
      row.appendChild(tile);
    }
    bd.appendChild(row);
  }
}

// ‚ïê‚ïê KEYBOARD ‚ïê‚ïê
const KBD_LAYOUT=[
  ['Q','W','E','R','T','Y','U','I','O','P'],
  ['A','S','D','F','G','H','J','K','L'],
  ['ENTER','Z','X','C','V','B','N','M','‚å´']
];

function buildKbd(elId, handler, prefix, mapObj){
  const kbd=document.getElementById(elId);
  kbd.innerHTML='';
  KBD_LAYOUT.forEach(row=>{
    const kr=document.createElement('div'); kr.className='k-row';
    row.forEach(k=>{
      const btn=document.createElement('button'); 
      btn.className='key'+(k.length>1?' wide':'');
      btn.textContent=k; 
      btn.id=prefix+k;
      btn.onclick=()=>handler(k);
      kr.appendChild(btn);
      mapObj[k]=btn;
    });
    kbd.appendChild(kr);
  });
}

// ‚ïê‚ïê UPDATE KEY COLOR ‚ïê‚ïê
function setKeyState(k, state){
  const el=kbdMap[k];
  if(!el) return;
  if(state==='correct'&&!el.classList.contains('correct')) el.className='key correct';
  else if(state==='present'&&!el.classList.contains('correct')&&!el.classList.contains('present')) el.className='key present';
  else if(state==='absent'&&!el.classList.contains('correct')&&!el.classList.contains('present')) el.className='key absent';
}

// ‚ïê‚ïê GAME KEY HANDLER ‚ïê‚ïê
function gKey(k){
  if(locked) return;
  const K=k.toUpperCase();
  if(K==='‚å´'||K==='BACKSPACE'){
    if(cCol<=0) return;
    cCol--; guess.pop();
    const t=document.getElementById('t'+cRow+'-'+cCol);
    t.textContent=''; t.className='tile';
  } else if(K==='ENTER'){
    if(cCol<5) return;
    checkGuess();
  } else if(/^[A-Z]$/.test(K)){
    if(cCol>=5) return;
    guess.push(K);
    const t=document.getElementById('t'+cRow+'-'+cCol);
    t.textContent=K; t.classList.add('filled','pop');
    setTimeout(()=>t.classList.remove('pop'), 100);
    cCol++;
  }
}

// ‚ïê‚ïê CHECK GUESS ‚ïê‚ïê
function checkGuess(){
  const word=guess.join('');
  const tLetters=TARGET.split('');
  const res=Array(5).fill('absent');
  const used=Array(5).fill(false);
  // correct positions
  guess.forEach((l,i)=>{
    if(l===tLetters[i]){ res[i]='correct'; used[i]=true; }
  });
  // present positions
  guess.forEach((l,i)=>{
    if(res[i]==='correct') return;
    for(let j=0;j<5;j++){
      if(!used[j]&&l===tLetters[j]){ res[i]='present'; used[j]=true; break; }
    }
  });
  locked=true;
  // flip tiles
  guess.forEach((l,i)=>{
    setTimeout(()=>{
      const t=document.getElementById('t'+cRow+'-'+i);
      t.classList.add(res[i]);
      setKeyState(l, res[i]);
    }, i*250);
  });
  setTimeout(()=>{
    const allCorrect=res.every(s=>s==='correct');
    if(allCorrect){
      document.getElementById('row'+cRow).classList.add('row-bounce');
      setTimeout(()=>{
        showToast('Correct!');
        setTimeout(()=>{
          showScreen('screen-val');
          startStars('sc1');
          buildKbd('val-keyboard', vKey, 'vk-', vKbdMap);
          highlightYesKeys();
        }, 800);
      }, 700);
    } else {
      cRow++; cCol=0; guess=[]; locked=false;
      document.getElementById('counter').textContent=cRow+' / 6';
      if(cRow<6){
        document.getElementById('hint-line').textContent=HINTS[cRow];
      } else {
        showToast('Out of tries!');
        document.getElementById('hint-line').textContent='';
        document.getElementById('action-btns').style.display='flex';
      }
    }
  }, guess.length*250+400);
}

// ‚ïê‚ïê PLAY AGAIN ‚ïê‚ïê
function playAgain(){
  cRow=0; cCol=0; guess=[]; locked=false; gaveUp=false;
  initBoard();
  buildKbd('keyboard', gKey, 'gk-', kbdMap);
  document.getElementById('hint-line').textContent=HINTS[0];
  document.getElementById('counter').textContent='0 / 6';
  document.getElementById('action-btns').style.display='none';
}

// ‚ïê‚ïê GIVE UP ‚ïê‚ïê
function giveUp(){
  if(gaveUp) return;
  gaveUp=true;
  
  const message = ['WILL', 'YOU', 'BE', 'MY', 'VALENTINE'];
  const letters = 'WILLYOUBEMYVALENTINE'.split('');
  
  // First, shuffle all letters randomly
  for(let r=0; r<6; r++){
    for(let c=0; c<5; c++){
      const tile = document.getElementById('t'+r+'-'+c);
      const randomLetter = letters[Math.floor(Math.random() * letters.length)];
      tile.textContent = randomLetter;
      tile.classList.add('filled', 'shuffle');
    }
  }
  
  // After shuffle animation, reveal the message word by word
  setTimeout(() => {
    // First 4 rows: WILL, YOU, BE, MY (4 words, left-aligned)
    for(let row=0; row<4; row++){
      setTimeout(() => {
        // Clear the row first
        for(let c=0; c<5; c++){
          const tile = document.getElementById('t'+row+'-'+c);
          tile.classList.remove('shuffle');
          tile.textContent = '';
          tile.classList.remove('filled', 'correct', 'present', 'absent');
        }
        
        // Then fill with the word
        setTimeout(() => {
          const word = message[row];
          const letters = word.split('');
          const startCol = 0; // Left-align instead of center
          
          letters.forEach((letter, i) => {
            setTimeout(() => {
              const tile = document.getElementById('t'+row+'-'+(startCol+i));
              tile.textContent = letter;
              tile.classList.add('filled', 'correct', 'pop');
              setTimeout(() => tile.classList.remove('pop'), 100);
            }, i * 150);
          });
        }, 100);
      }, row * 1000);
    }
    
    // Rows 4 and 5: VALENTINE (split across two rows since it's 9 letters)
    setTimeout(() => {
      // Clear rows 4 and 5
      for(let r=4; r<6; r++){
        for(let c=0; c<5; c++){
          const tile = document.getElementById('t'+r+'-'+c);
          tile.classList.remove('shuffle');
          tile.textContent = '';
          tile.classList.remove('filled', 'correct', 'present', 'absent');
        }
      }
      
      setTimeout(() => {
        const valentine = 'VALENTINE'.split('');
        // First row: VALEN (5 letters)
        for(let i=0; i<5; i++){
          setTimeout(() => {
            const tile = document.getElementById('t4-'+i);
            tile.textContent = valentine[i];
            tile.classList.add('filled', 'correct', 'pop');
            setTimeout(() => tile.classList.remove('pop'), 100);
          }, i * 150);
        }
        // Second row: TINE (4 letters) + question mark
        for(let i=0; i<4; i++){
          setTimeout(() => {
            const tile = document.getElementById('t5-'+i);
            tile.textContent = valentine[5+i];
            tile.classList.add('filled', 'correct', 'pop');
            setTimeout(() => tile.classList.remove('pop'), 100);
          }, (5+i) * 150);
        }
        // Add question mark to last box
        setTimeout(() => {
          const tile = document.getElementById('t5-4');
          tile.textContent = '?';
          tile.classList.add('filled', 'pop');
          setTimeout(() => tile.classList.remove('pop'), 100);
        }, 9 * 150);
      }, 100);
    }, 4 * 1000);
    
    // After all words are revealed, show valentine screen
    setTimeout(() => {
      showScreen('screen-val');
      startStars('sc1');
      buildKbd('val-keyboard', vKey, 'vk-', vKbdMap);
      highlightYesKeys();
    }, 5 * 1000 + 1500);
    
  }, 1400); // Wait for shuffle animation
}

// ‚ïê‚ïê HIGHLIGHT YES KEYS ‚ïê‚ïê
function highlightYesKeys(){
  const yesKeys = ['Y', 'E', 'S'];
  yesKeys.forEach(k => {
    const key = vKbdMap[k];
    if(key) {
      key.classList.add('hint-glow');
    }
  });
  document.getElementById('val-hint').textContent = 'Hint: Look at the highlighted keys';
}

// ‚ïê‚ïê VALENTINE KEY HANDLER ‚ïê‚ïê
function vKey(k){
  console.log('vKey called with:', k, 'aLocked:', aLocked, 'aCol:', aCol);
  
  if(aLocked) return;
  const K=k.toUpperCase();
  
  if(K==='‚å´'||K==='BACKSPACE'){
    if(aCol<=0) return;
    aCol--; aGuess.pop();
    const t=document.getElementById('at'+aCol);
    t.textContent=''; t.className='a-tile';
    console.log('Backspace - aCol now:', aCol);
    
  } else if(K==='ENTER'){
    console.log('ENTER pressed, aCol:', aCol);
    if(aCol<2) return;
    
    const ans=aGuess.join('');
    console.log('Answer:', ans);
    aLocked=true;
    
    // Flip tiles orange
    for(let i=0; i<aGuess.length; i++){
      setTimeout(() => {
        const tile = document.getElementById('at'+i);
        console.log('Flipping tile', i, 'orange');
        tile.classList.add('orange');
      }, i * 180);
    }
    
    // Wait for flip to complete
    setTimeout(() => {
      if(ans === 'YES'){
        console.log('YES - going to preparing');
        goToPreparing();
      } else {
        console.log('NOT YES - shaking and showing message');
        
        // Shake the board
        const ansBoard = document.getElementById('ans-board');
        ansBoard.classList.add('row-shake');
        console.log('Added row-shake class');
        
        // Show please message
        noCount++;
        const hintEl = document.getElementById('val-hint');
        const pleaseMessages = ['Please?','Pretty please?','Come on...','I\'ll cry','Please na'];
        hintEl.textContent = pleaseMessages[Math.min(noCount-1, pleaseMessages.length-1)];
        console.log('Set hint to:', hintEl.textContent);
        
        // Remove shake after animation
        setTimeout(() => {
          ansBoard.classList.remove('row-shake');
          console.log('Removed row-shake class');
        }, 400);
        
        // Clear tiles and reset
        setTimeout(() => {
          console.log('Clearing tiles');
          aGuess = []; 
          aCol = 0; 
          aLocked = false;
          
          for(let i=0; i<3; i++){
            const t = document.getElementById('at'+i);
            t.textContent = ''; 
            t.className = 'a-tile';
          }
          
          // Rebuild keyboard with hints
          buildKbd('val-keyboard', vKey, 'vk-', vKbdMap);
          highlightYesKeys();
          console.log('Reset complete');
        }, 1200);
      }
    }, aGuess.length * 180 + 350);
    
  } else if(/^[A-Z]$/.test(K)){
    if(aCol>=3) return;
    aGuess.push(K);
    const t=document.getElementById('at'+aCol);
    t.textContent=K; 
    t.classList.add('filled','pop');
    setTimeout(()=>t.classList.remove('pop'), 100);
    aCol++;
    console.log('Added letter', K, '- aCol now:', aCol);
  }
}

// ‚ïê‚ïê PREPARING SCREEN ‚ïê‚ïê
function goToPreparing(){
  showScreen('screen-prep');
  startStars('sc2');
  [0,1,2].forEach(i=>{
    document.getElementById('pt'+i).classList.remove('show');
    setTimeout(()=>document.getElementById('pt'+i).classList.add('show'), (i+1)*270);
  });
  setTimeout(()=>{
    showScreen('screen-celeb');
    startStars('sc3');
    launchConfetti();
  }, 3700);
}

// ‚ïê‚ïê EMAIL & TICKET ‚ïê‚ïê
const SURPRISE_VIDEO_URL = 'valentine/Final.mp4';
const RECIPIENT_EMAIL = 'ruffapadayao@gmail.com';
// EmailJS: https://dashboard.emailjs.com/ ‚Üí Email Services ‚Üí click your Gmail service ‚Üí copy "Service ID"
const EMAILJS_SERVICE_ID = 'service_qrfyfel';
const EMAILJS_TEMPLATE_ID = 'template_azmez4l'; // ‚Üê Email Templates ‚Üí Template ID
const EMAILJS_PUBLIC_KEY = '6oMscLy1Chy74PAms'; // ‚Üê Account ‚Üí General ‚Üí Public Key

const TICKET_MESSAGE = "You're invited to my heart on Valentine's Day. üíï";
const TICKET_FROM = "Your Valentine";

function buildTicketHTML(){
  const safeMsg = TICKET_MESSAGE.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/\n/g,'<br>');
  const safeFrom = TICKET_FROM.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  return '<div style="max-width:360px;margin:0 auto;font-family:\'Segoe UI\',Arial,sans-serif;background:linear-gradient(145deg,#1a0a0f 0%,#2d1520 50%,#1a0a0f 100%);border:3px solid #c84e1a;border-radius:16px;overflow:hidden;box-shadow:0 8px 32px rgba(200,78,26,.35),inset 0 1px 0 rgba(255,255,255,.08);">'
    + '<div style="padding:24px 28px;text-align:center;">'
    + '<div style="font-size:11px;letter-spacing:.25em;color:#d4af37;margin-bottom:6px;">VALENTINE\'S DAY</div>'
    + '<div style="border-bottom:2px dashed rgba(255,255,255,.2);margin:0 0 20px 0;"></div>'
    + '<div style="font-size:42px;font-weight:900;color:#fff;letter-spacing:.15em;line-height:1;margin-bottom:8px;">FEB 14</div>'
    + '<div style="font-size:13px;color:rgba(255,255,255,.7);margin-bottom:20px;">Save the date</div>'
    + '<div style="border-bottom:2px dashed rgba(255,255,255,.2);margin:0 0 20px 0;"></div>'
    + '<div style="font-size:15px;color:rgba(255,255,255,.95);line-height:1.6;margin-bottom:20px;min-height:40px;">'+safeMsg+'</div>'
    + '<div style="border-bottom:2px dashed rgba(255,255,255,.2);margin:0 0 16px 0;"></div>'
    + '<div style="font-size:12px;color:rgba(255,255,255,.6);">From</div>'
    + '<div style="font-size:14px;font-weight:700;color:#e8a060;">'+safeFrom+'</div>'
    + '<div style="margin-top:16px;font-size:18px;">üíï</div>'
    + '</div></div>';
}

function sendEmail(){
  const status=document.getElementById('eStatus');
  const btn=document.getElementById('sendBtn');
  btn.disabled=true; btn.textContent='Sending...';
  status.style.color='rgba(255,255,255,.45)'; status.textContent='Preparing your ticket...';
  const ticketHTML = buildTicketHTML();
  const templateParams = {
    to_email: RECIPIENT_EMAIL,
    email: RECIPIENT_EMAIL,
    from_email: TICKET_FROM,
    subject: 'Valentine Ticket ‚Äì Feb 14 üíï',
    ticket_html: ticketHTML
  };
  const hasEmailJS = typeof emailjs !== 'undefined' && EMAILJS_SERVICE_ID && EMAILJS_TEMPLATE_ID && EMAILJS_PUBLIC_KEY;
  if(hasEmailJS){
    emailjs.init(EMAILJS_PUBLIC_KEY);
    emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, templateParams).then(()=>{
      doneSending(status, btn);
    }).catch(function(err){
      console.error('EmailJS error:', err);
      var msg=(err && (err.text || err.message)) ? (err.text || err.message) : 'Try again (use http, not file)';
      status.style.color='#ff9999'; status.textContent='Send failed: '+String(msg).slice(0,50); btn.disabled=false; btn.textContent='Send Me the Surprise';
    });
  } else {
    setTimeout(()=>doneSending(status, btn), 1800);
  }
}

function doneSending(status, btn){
  btn.textContent='‚úì Sent!';
  status.style.color='#90ee90';
  status.textContent='Ticket sent!';
  var tiles=document.querySelector('#screen-celeb .celeb-tiles');
  var yesH=document.querySelector('#screen-celeb .celeb-h');
  if(tiles) tiles.style.display='none';
  if(yesH) yesH.style.display='none';
  setTimeout(showAnimatedVideoScreen, 2200);
}

function showAnimatedVideoScreen(){
  const screen = document.getElementById('screen-video');
  const videoEl = document.getElementById('surpriseVideo');
  screen.classList.add('active');
  videoEl.src = SURPRISE_VIDEO_URL;
  videoEl.load();
  videoEl.play().catch(()=>{});
}

function closeVideoScreen(){
  document.getElementById('screen-video').classList.remove('active');
  const v = document.getElementById('surpriseVideo');
  v.pause(); v.src = '';
}

// ‚ïê‚ïê TWINKLING STARS ‚ïê‚ïê
function startStars(id){
  const cv=document.getElementById(id); if(!cv) return;
  const ctx=cv.getContext('2d');
  function resize(){ cv.width=window.innerWidth; cv.height=window.innerHeight; }
  resize(); window.addEventListener('resize', resize);
  const stars=Array.from({length:88},()=>({
    x:Math.random()*window.innerWidth, y:Math.random()*window.innerHeight,
    r:Math.random()*2+0.4, o:Math.random()*.7+.1,
    spd:Math.random()*.025+.008, dir:1, big:Math.random()>.5
  }));
  (function draw(){
    cv.width=window.innerWidth; cv.height=window.innerHeight;
    ctx.clearRect(0,0,cv.width,cv.height);
    stars.forEach(s=>{
      s.o+=s.spd*s.dir;
      if(s.o>.92) s.dir=-1; if(s.o<.08) s.dir=1;
      ctx.save(); ctx.translate(s.x,s.y); ctx.globalAlpha=s.o; ctx.fillStyle='#d4af37';
      if(s.big&&s.r>1.2){
        const len=s.r*3;
        ctx.beginPath();
        ctx.moveTo(0,-len); ctx.lineTo(s.r*.28,-s.r*.28); ctx.lineTo(len,0); ctx.lineTo(s.r*.28,s.r*.28);
        ctx.lineTo(0,len); ctx.lineTo(-s.r*.28,s.r*.28); ctx.lineTo(-len,0); ctx.lineTo(-s.r*.28,-s.r*.28);
        ctx.closePath(); ctx.fill();
      } else { ctx.beginPath(); ctx.arc(0,0,s.r,0,Math.PI*2); ctx.fill(); }
      ctx.restore();
    });
    requestAnimationFrame(draw);
  })();
}

// ‚ïê‚ïê CONFETTI ‚ïê‚ïê
function launchConfetti(){
  if(!document.getElementById('cf-kf')){
    const s=document.createElement('style'); s.id='cf-kf';
    s.textContent='@keyframes cf{0%{opacity:1;transform:translateY(0) rotate(0deg);}100%{opacity:0;transform:translateY(110vh) rotate(720deg);}}';
    document.head.appendChild(s);
  }
  const cols=['#c84e1a','#d4af37','#ff6b9d','#ffb3cc','#fff','#e8a060'];
  for(let i=0;i<110;i++){
    setTimeout(()=>{
      const el=document.createElement('div');
      const w=6+Math.random()*8, h=8+Math.random()*12;
      el.style.cssText='position:fixed;top:-18px;left:'+Math.random()*100+'vw;width:'+w+'px;height:'+h+'px;background:'+cols[Math.floor(Math.random()*cols.length)]+';border-radius:2px;animation:cf '+(2+Math.random()*2.5)+'s linear '+(Math.random()*.8)+'s forwards;transform:rotate('+Math.random()*360+'deg);z-index:9999;pointer-events:none;';
      document.body.appendChild(el);
      setTimeout(()=>el.remove(), 5000);
    }, i*20);
  }
}

// ‚ïê‚ïê SCREEN SWITCH ‚ïê‚ïê
function showScreen(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// ‚ïê‚ïê PHYSICAL KEYBOARD ‚ïê‚ïê
document.addEventListener('keydown', e=>{
  if(e.ctrlKey||e.metaKey||e.altKey) return;
  const k=e.key.toUpperCase();
  const active=document.querySelector('.screen.active')?.id;
  if(active==='screen-game'){
    if(k==='BACKSPACE') gKey('‚å´');
    else if(k==='ENTER') gKey('ENTER');
    else if(/^[A-Z]$/.test(k)) gKey(k);
  } else if(active==='screen-val'){
    if(k==='BACKSPACE') vKey('‚å´');
    else if(k==='ENTER') vKey('ENTER');
    else if(/^[A-Z]$/.test(k)) vKey(k);
  }
});

// ‚ïê‚ïê START ‚ïê‚ïê
initBoard();
buildKbd('keyboard', gKey, 'gk-', kbdMap);
document.getElementById('hint-line').textContent=HINTS[0];
</script>
</body>
</html>
